# 第七章 特征检测

## 1. 线段检测

线段检测的基本思想有两个：

1. **空间变换**：霍夫变换中，会将图像边缘像素映射到一个极坐标或其它累加空间，并在累加空间中找极大值点对应的直线或线段。
2. **后续合并**：如果检出很多近似平行并且重叠度较高的线段，会做一个“合并距离”与“角度差”判断，把它们合并成一条线段。在庐山派中就是体现为两个参数，`merge_distance`和`max_theta_difference`。

### 1.1 find_line_segments

```python
image.find_line_segments(roi, merge_distance=0, max_theta_difference=15)
```

该函数使用霍夫变换查找图像中的线段，并返回一个 `image.line` 对象的列表。

- `roi` 为感兴趣区域的矩形元组 `(x, y, w, h)`。若未指定，ROI 默认为整个图像的矩形。操作仅限于该区域内的像素。
- `merge_distance` 指定两条线段之间的最大像素距离，若小于该值则合并为一条线段。
- `max_theta_difference` 为需合并的两条线段之间的最大角度差。

该方法使用 LSD 库（OpenCV 亦采用）来查找图像中的线段。虽然速度较慢，但准确性高，且线段不会出现跳跃现象。

### 1.2 使用示例

```python

```



## 2. 矩形检测

矩形检测一般用于条码检测，可以先定位条码或者二维码，然后再去解码，提高运行速度。也常用来OCR的前置检测，先定位文档中的文字块或段落。CanMV固件中的`find_rects`函数使用了与 AprilTag 中的四边形检测类似的算法，能适应一定程度的平移、旋转和仿射变化（扭曲）。
